#+TITLE: Sway dispatch
#+AUTHOR: Rafael Ito
#+PROPERTY: header-args :tangle sway-dispatch.sh
#+DESCRIPTION: script meant to work the same way of xremap in respect to sending different keypresses according to the focused application
#+STARTUP: showeverything
#+auto_tangle: t

* Table of Contents :toc_3:
- [[#header][Header]]
- [[#change-focus][Change focus]]
- [[#kill-window][Kill window]]
- [[#cutcopypaste][Cut/Copy/Paste]]
  - [[#cut][Cut]]
  - [[#copy][Copy]]
  - [[#paste][Paste]]
- [[#fullscreen][Fullscreen]]
- [[#new-terminal][New terminal]]

* Header :noexport_1:
** Shebang
#+begin_src sh
#!/usr/bin/env bash
#+end_src
** Shared group
:PROPERTIES:
:header-args: :padline no :tangle sway-dispatch.sh
:END:
#+begin_src sh :padline yes
shopt -s extglob  # enable special variable syntax
#+end_src
*** Terminals
#+begin_src sh :padline yes
TERMINAL_LIST=(
    "kitty"
    "dropdown_terminal"
    "dropdown_python"
)
#+end_src
*** Merge list with "|"
#+begin_src sh :padline yes
IFS='|'  # set separator to pipe temporarily
TERMINALS="@(${TERMINAL_LIST[*]})"
unset IFS  # reset separator
#+end_src
** Help menu
#+begin_src sh
# Usage:
# ./smart_dispatch.sh focus left
# ./smart_dispatch.sh type symbol
# ./smart_dispatch.sh launch
#+end_src
** Parse parameters
#+begin_src sh
COMMAND="$1"
PARAM="$2"

# get the app_id of the focused window
# some XWayland apps might have null app_id, so we fallback to window_properties.class if needed
FOCUSED_APP=$(swaymsg -t get_tree | jq -r '.. | select(.focused? == true) | if .app_id then .app_id else .window_properties.class end')
#+end_src
** Dispatcher
#+begin_src sh
case "$COMMAND" in
#+end_src
* Change focus
#+begin_src sh
"focus")
    DIRECTION="$PARAM"
    case "$FOCUSED_APP" in
        [Ee]macs*) emacsclient -s efs --eval "(evil-window-$DIRECTION 1)" > /dev/null 2>&1 ;;
        *) swaymsg focus "$DIRECTION" ;;
    esac
    ;;
#+end_src
* Kill window
#+begin_src sh
"kill")
    case "$FOCUSED_APP" in
        [Ee]macs*) emacsclient -s efs --eval "(evil-quit)" > /dev/null 2>&1 ;;
        *) "$HOME/.config/scripts/hide-or-kill.sh" ;;
    esac
    ;;
#+end_src
* Cut/Copy/Paste
** Cut
#+begin_src sh
"cut")
    case "$FOCUSED_APP" in
        [Ee]macs*) emacsclient -s efs --eval "(execute-extended-command)" >/dev/null 2>&1 ;;
        $TERMINALS) ydotool key 29:1 42:1 45:1 45:0 42:0 29:0 ;; # C-S-x
        ,*) ydotool key 29:1 45:1 45:0 29:0 ;; # C-x
    esac
    ;;
#+end_src
** Copy
#+begin_src sh
"copy")
    case "$FOCUSED_APP" in
        [Ee]macs*) emacsclient -s efs --eval "(evil-yank)" > /dev/null 2>&1 ;;
        $TERMINALS) ydotool key 29:1 42:1 46:1 46:0 42:0 29:0 ;; # C-S-c
        *) ydotool key 29:1 46:1 46:0 29:0 ;; # C-c
    esac
    ;;
#+end_src
** Paste
#+begin_src sh
"paste")
    case "$FOCUSED_APP" in
        [Ee]macs*) emacsclient -s efs --eval "(evil-paste-before)" > /dev/null 2>&1 ;;
        $TERMINALS) ydotool key 29:1 42:1 47:1 47:0 42:0 29:0 ;; # C-S-v
        *) ydotool key 29:1 47:1 47:0 29:0 ;; # C-v
    esac
    ;;
#+end_src
* Fullscreen
#+begin_src sh
"fullscreen")
    case "$FOCUSED_APP" in
        [Ee]macs*) emacsclient -s efs --eval "(zoom-window-zoom)" > /dev/null 2>&1 ;;
        *) swaymsg fullscreen toggle ;;
    esac
    ;;
#+end_src
* New terminal
#+begin_src sh
"new_terminal")
    case "$FOCUSED_APP" in
        [Ee]macs*) emacsclient -n -s efs --eval "(progn (split-window-autotiling) (other-window 1) (counsel-find-file))" > /dev/null 2>&1 ;;
        *) kitty ;;
    esac
    ;;
#+end_src
(global-set-key (kbd "M-s-g") '(lambda () (interactive) (split-window-autotiling) (other-window 1) (counsel-find-file)))

* EoS :noexport:
#+begin_src sh
esac
#+end_src
