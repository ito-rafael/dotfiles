#+TITLE: Configs for LibreOffice Calc
#+AUTHOR: Rafael Ito
#+DESCRIPTION: configs for LibreOffice Calc
#+STARTUP: showeverything
#+auto_tangle: t

* Table of Contents :toc:
- [[#macro][Macro]]
  - [[#paint-cells][Paint cells]]
  - [[#outer-border][Outer border]]
- [[#keybindings][Keybindings]]

* Macro
:PROPERTIES:
:header-args: :tangle macros
:END:
1. Tools > Macros > Organize Macros > Basic
2. Paste the macro below into "My Macros"
** Paint cells
*** Function
#+begin_src conf
Sub ToggleCellColor(color As Long)
    Dim oCellRange As Object
    Dim oCell As Object
    Dim i As Integer, j As Integer
    Dim totalRows As Integer, totalCols As Integer
    Dim allCellsAreTargetColor As Boolean

    oCellRange = ThisComponent.CurrentSelection

    If oCellRange.supportsService("com.sun.star.sheet.SheetCellRange") Then
        totalRows = oCellRange.Rows.getCount()
        totalCols = oCellRange.Columns.getCount()
        allCellsAreTargetColor = True  ' Assume all cells are in target color initially

        ' First pass: check if all cells are the target color
        For i = 0 To totalRows - 1
            For j = 0 To totalCols - 1
                oCell = oCellRange.getCellByPosition(j, i)
                If oCell.CellBackColor <> color Then
                    allCellsAreTargetColor = False
                    Exit For
                End If
            Next j
            If Not allCellsAreTargetColor Then Exit For
        Next i

        ' Second pass: apply color or remove it
        For i = 0 To totalRows - 1
            For j = 0 To totalCols - 1
                oCell = oCellRange.getCellByPosition(j, i)
                If allCellsAreTargetColor Then
                    oCell.CellBackColor = -1  ' Set to transparent
                Else
                    oCell.CellBackColor = color  ' Set to target color
                End If
            Next j
        Next i

    ElseIf oCellRange.supportsService("com.sun.star.sheet.SheetCell") Then
        If oCellRange.CellBackColor = color Then
            oCellRange.CellBackColor = -1
        Else
            oCellRange.CellBackColor = color
        End If
    End If
End Sub
#+end_src
*** Colors
**** Yellow
#+begin_src conf
Sub PaintCellYellow
    ToggleCellColor(RGB(255, 255, 166))
End Sub
#+end_src
**** Green
#+begin_src conf
Sub PaintCellGreen
    ToggleCellColor(RGB(175, 208, 149))
End Sub
#+end_src
**** Red
#+begin_src conf
Sub PaintCellRed
    ToggleCellColor(RGB(255, 166, 166))
End Sub
#+end_src
**** Gray
#+begin_src conf
Sub PaintCellGray
    ToggleCellColor(RGB(204, 204, 204))
End Sub
#+end_src
**** Transparent
#+begin_src conf
Sub PaintCellTransparent
    ToggleCellColor(-1)
End Sub
#+end_src
** Outer border
#+begin_src conf
Sub SetOuterBorder
    Dim oDoc As Object
    Dim oSel As Object
    Dim oRange As Object
    Dim oBorder As New com.sun.star.table.BorderLine
    Dim oTableBorder

    oDoc = ThisComponent
    oSel = oDoc.getCurrentSelection()

    ' Make sure selection is a cell range
    If oSel.supportsService("com.sun.star.sheet.SheetCellRange") Then
        oRange = oSel

        ' Define a single black line (1pt) for outer border
        oBorder.OuterLineWidth = 10   ' 100 = 1pt
        oBorder.InnerLineWidth = 0
        oBorder.LineDistance = 0
        oBorder.Color = RGB(0, 0, 0)

        ' Create an empty border object (no need to declare its type)
        oTableBorder = oRange.TableBorder

        ' Set only the outer borders
        oTableBorder.TopLine = oBorder
        oTableBorder.BottomLine = oBorder
        oTableBorder.LeftLine = oBorder
        oTableBorder.RightLine = oBorder

        ' Assign the modified border back to the range
        oRange.TableBorder = oTableBorder
    Else
        MsgBox "Please select a range of cells first.", 48, "Invalid Selection"
    End If
End Sub
#+end_src
* Keybindings
1. Tools > Customize > Keyboard
2. Assign a shortcut to a function
|----------+----------+------------------------+-----------------------------------------------------------------------------------------------|
| shortcut | category | description            | function                                                                                      |
|----------+----------+------------------------+-----------------------------------------------------------------------------------------------|
| Alt+M    | macro    | paint cell Transparent | vnd.sun.star.script:Standard.Module1.PaintCellTransparent?language=Basic&location=application |
| Alt+N    | macro    | paint cell Yellow      | vnd.sun.star.script:Standard.Module1.PaintCellYellow?language=Basic&location=application      |
| Alt+E    | macro    | paint cell Green       | vnd.sun.star.script:Standard.Module1.PaintCellGreen?language=Basic&location=application       |
| Alt+I    | macro    | paint cell Red         | vnd.sun.star.script:Standard.Module1.PaintCellRed?language=Basic&location=application         |
| Alt+O    | macro    | paint cell Gray        | vnd.sun.star.script:Standard.Module1.PaintCellGray?language=Basic&location=application        |
|----------+----------+------------------------+-----------------------------------------------------------------------------------------------|
